hw2
================
2025-09-28

# Problem 1

## Clean_pm

``` r
pols = read_csv("./data/pols-month.csv")
```

    ## Rows: 822 Columns: 9
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## dbl  (8): prez_gop, gov_gop, sen_gop, rep_gop, prez_dem, gov_dem, sen_dem, r...
    ## date (1): mon
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
pols = pols |>
  separate(mon, into = c("year", "month", "day"), sep = "-") |>
  mutate(
    year = as.integer(year),
    month = as.integer(month),
    month = month.name[month],
    president = case_when(
      prez_gop == 1 ~ "gop",
      prez_dem == 1 ~ "dem"
    )
  ) |>
  select(-day, -prez_gop, -prez_dem)
glimpse(pols)
```

    ## Rows: 822
    ## Columns: 9
    ## $ year      <int> 1947, 1947, 1947, 1947, 1947, 1947, 1947, 1947, 1947, 1947, …
    ## $ month     <chr> "January", "February", "March", "April", "May", "June", "Jul…
    ## $ gov_gop   <dbl> 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 24, 24, 22, 22, 22, …
    ## $ sen_gop   <dbl> 51, 51, 51, 51, 51, 51, 51, 51, 51, 51, 51, 51, 53, 53, 53, …
    ## $ rep_gop   <dbl> 253, 253, 253, 253, 253, 253, 253, 253, 253, 253, 253, 253, …
    ## $ gov_dem   <dbl> 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 24, 24, 24, …
    ## $ sen_dem   <dbl> 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 48, 48, 48, …
    ## $ rep_dem   <dbl> 198, 198, 198, 198, 198, 198, 198, 198, 198, 198, 198, 198, …
    ## $ president <chr> "dem", "dem", "dem", "dem", "dem", "dem", "dem", "dem", "dem…

## Clean_snp

``` r
snp = read_csv("./data/snp.csv")
```

    ## Rows: 787 Columns: 2
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr (1): date
    ## dbl (1): close
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
snp = snp |>
  separate(date, into = c("month", "day", "year"), sep = "/") |>
  mutate(
    year = as.integer(year),
    month = as.integer(month),
    month = month.name[month]
  ) |>
  select(year, month, close) |>
  arrange(year, match(month, month.name))
glimpse(snp)
```

    ## Rows: 787
    ## Columns: 3
    ## $ year  <int> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…
    ## $ month <chr> "January", "February", "March", "April", "May", "June", "July", …
    ## $ close <dbl> 1394.46, 1366.42, 1498.58, 1452.43, 1420.60, 1454.60, 1430.83, 1…

## Unemployment clean and merge

``` r
# Tidy unemployment and merge all datasets
unemp = read_csv("./data/unemployment.csv") |>
  pivot_longer(cols = -Year, names_to = "month", values_to = "unemployment") |>
  mutate(
    month = month.name[match(month, month.abb)],  # convert Jan → January, etc.
    year = Year
  ) |>
  select(year, month, unemployment)
```

    ## Rows: 68 Columns: 13
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## dbl (13): Year, Jan, Feb, Mar, Apr, May, Jun, Jul, Aug, Sep, Oct, Nov, Dec
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
merged_df = pols |>
  left_join(snp, by = c("year", "month")) |>
  left_join(unemp, by = c("year", "month"))

glimpse(merged_df)
```

    ## Rows: 822
    ## Columns: 11
    ## $ year         <dbl> 1947, 1947, 1947, 1947, 1947, 1947, 1947, 1947, 1947, 194…
    ## $ month        <chr> "January", "February", "March", "April", "May", "June", "…
    ## $ gov_gop      <dbl> 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 24, 24, 22, 22, 2…
    ## $ sen_gop      <dbl> 51, 51, 51, 51, 51, 51, 51, 51, 51, 51, 51, 51, 53, 53, 5…
    ## $ rep_gop      <dbl> 253, 253, 253, 253, 253, 253, 253, 253, 253, 253, 253, 25…
    ## $ gov_dem      <dbl> 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 24, 24, 2…
    ## $ sen_dem      <dbl> 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 48, 48, 4…
    ## $ rep_dem      <dbl> 198, 198, 198, 198, 198, 198, 198, 198, 198, 198, 198, 19…
    ## $ president    <chr> "dem", "dem", "dem", "dem", "dem", "dem", "dem", "dem", "…
    ## $ close        <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
    ## $ unemployment <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 3.4, 3.8,…

## descirption

The pols-month dataset has 822 rows and 9 variables covering the years
1947 to 2015. Key variables include year, month, counts of governors,
senators, and representatives from each party, and an indicator for the
sitting president’s party.

The snp dataset has 787 rows and 3 variables, with data spanning much of
the 20th century into the early 2000s. The key variables are year,
month, and the stock market closing price (close).

The unemployment dataset contains over 816 (68\*12) monthly
observations, with variables year, month, and the unemployment rate
(unemployment).

Finally, the merged dataset joins these three sources into a single
table of 822 rows and 11 variables, indexed by year and month. This
combined dataset allows us to analyze relationships among political
party , market performance, and unemployment across time.

# Problem 2

``` r
# Clean Mr. Trash Wheel
mr_trash = read_excel(
  "./data/202509 Trash Wheel Collection Data.xlsx",
  sheet = "Mr. Trash Wheel",
  skip = 1
) |>
  janitor::clean_names() |> #remove caps
  filter(!is.na(dumpster)) |> # remove the na row
  mutate(
    year = as.character(year),
    month = as.character(month),
    sports_balls = as.integer(round(sports_balls, 0)),
    wheel = "Mr. Trash Wheel"
  ) |>
  select(-starts_with("x"))
```

    ## New names:
    ## • `` -> `...15`
    ## • `` -> `...16`

``` r
# Clean Professor Trash Wheel
prof_trash = read_excel(
  "./data/202509 Trash Wheel Collection Data.xlsx",
  sheet = "Professor Trash Wheel",
  skip = 1
) |> # do the same as aboves but no sports balls
  janitor::clean_names() |>
  filter(!is.na(dumpster)) |>
  mutate(
    year = as.character(year),
    month = as.character(month),
    wheel = "Professor Trash Wheel"
  ) |>
  select(-starts_with("x"))

# Clean Gwynns
gwynnda_trash = read_excel(
  "./data/202509 Trash Wheel Collection Data.xlsx",
  sheet = "Gwynns Falls Trash Wheel",
  skip = 1
) |>
  janitor::clean_names() |>
  filter(!is.na(dumpster)) |> #same as above
  mutate(
    year = as.character(year),
    month = as.character(month),
    wheel = "Gwynns"
  ) |>
  select(-starts_with("x"))
```

## Combine all wheels

``` r
trash_data = bind_rows(mr_trash, prof_trash, gwynnda_trash)
prof_total_weight = trash_data |>
  filter(wheel == "Professor Trash Wheel") |>
  summarise(total_weight = sum(weight_tons, na.rm = TRUE))

gwynnda_cigs_june2022 = trash_data |>
  filter(wheel == "Gwynns", year == "2022", month == "June") |>
  summarise(total_cigs = sum(cigarette_butts, na.rm = TRUE))

head(trash_data)
```

    ## # A tibble: 6 × 15
    ##   dumpster month year  date                weight_tons volume_cubic_yards
    ##      <dbl> <chr> <chr> <dttm>                    <dbl>              <dbl>
    ## 1        1 May   2014  2014-05-16 00:00:00        4.31                 18
    ## 2        2 May   2014  2014-05-16 00:00:00        2.74                 13
    ## 3        3 May   2014  2014-05-16 00:00:00        3.45                 15
    ## 4        4 May   2014  2014-05-17 00:00:00        3.1                  15
    ## 5        5 May   2014  2014-05-17 00:00:00        4.06                 18
    ## 6        6 May   2014  2014-05-20 00:00:00        2.71                 13
    ## # ℹ 9 more variables: plastic_bottles <dbl>, polystyrene <dbl>,
    ## #   cigarette_butts <dbl>, glass_bottles <dbl>, plastic_bags <dbl>,
    ## #   wrappers <dbl>, sports_balls <int>, homes_powered <dbl>, wheel <chr>

``` r
prof_total_weight
```

    ## # A tibble: 1 × 1
    ##   total_weight
    ##          <dbl>
    ## 1         282.

``` r
gwynnda_cigs_june2022
```

    ## # A tibble: 1 × 1
    ##   total_cigs
    ##        <dbl>
    ## 1      18120

### description

The combined Trash Wheel dataset contains 1188 observations from three
wheels: Mr. Trash Wheel, Professor Trash Wheel, and Gwynnda. Each row
represents the contents of a single dumpster collected by one of the
wheels, with key variables including the dumpster ID (`dumpster`), date
of collection (`month`, `year`, and `date`), the weight of trash
collected in tons (`weight_tons`), the number of plastic bottles
(`plastic_bottles`), and the number of cigarette butts
(`cigarette_butts`). For example, Professor Trash Wheel has collected a
total of 282.26 tons of trash, while Gwynnda collected 1.812^{4}
cigarette butts in June 2022. These data allow us to compare not only
the total amount of waste collected across wheels but also the types of
trash they intercept over time.

# Problem 3

``` r
# The ZORI file from Zillow often has ID columns plus many monthly columns with dates as column names.
zori_raw = read_csv("./data/Zip_zori_uc_sfrcondomfr_sm_month_NYC.csv", guess_max = 30000)
```

    ## Rows: 149 Columns: 125
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr   (6): RegionType, StateName, State, City, Metro, CountyName
    ## dbl (119): RegionID, SizeRank, RegionName, 2015-01-31, 2015-02-28, 2015-03-3...
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
print(names(zori_raw)[1:min(30, length(names(zori_raw)))])
```

    ##  [1] "RegionID"   "SizeRank"   "RegionName" "RegionType" "StateName" 
    ##  [6] "State"      "City"       "Metro"      "CountyName" "2015-01-31"
    ## [11] "2015-02-28" "2015-03-31" "2015-04-30" "2015-05-31" "2015-06-30"
    ## [16] "2015-07-31" "2015-08-31" "2015-09-30" "2015-10-31" "2015-11-30"
    ## [21] "2015-12-31" "2016-01-31" "2016-02-29" "2016-03-31" "2016-04-30"
    ## [26] "2016-05-31" "2016-06-30" "2016-07-31" "2016-08-31" "2016-09-30"

## tidy

``` r
zori = zori_raw |> 
  janitor::clean_names()

# Identify date columns after clean_names() (they all start with "x20")
date_cols = names(zori)[str_detect(names(zori), "^x20")]

# Pivot longer
zori_long = zori |>
  pivot_longer(
    cols = all_of(date_cols),
    names_to = "date_raw",
    values_to = "zori"
  ) |>
  mutate(
    # Remove the "x" prefix and underscores from date
    date = str_remove(date_raw, "^x"),
    date = ymd(str_replace_all(date, "_", "-")),
    year = year(date),
    month = month(date, label = TRUE, abbr = FALSE)
  ) |>
  filter(!is.na(date), !is.na(zori)) |>
  select(region_id, size_rank, region_name, region_type, state_name, state,
         city, metro, county_name, date, year, month, zori)
glimpse(zori_long)
```

    ## Rows: 10,450
    ## Columns: 13
    ## $ region_id   <dbl> 62080, 62080, 62093, 62093, 62093, 62093, 62093, 62093, 62…
    ## $ size_rank   <dbl> 4, 4, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7…
    ## $ region_name <dbl> 11368, 11368, 11385, 11385, 11385, 11385, 11385, 11385, 11…
    ## $ region_type <chr> "zip", "zip", "zip", "zip", "zip", "zip", "zip", "zip", "z…
    ## $ state_name  <chr> "NY", "NY", "NY", "NY", "NY", "NY", "NY", "NY", "NY", "NY"…
    ## $ state       <chr> "NY", "NY", "NY", "NY", "NY", "NY", "NY", "NY", "NY", "NY"…
    ## $ city        <chr> "New York", "New York", "New York", "New York", "New York"…
    ## $ metro       <chr> "New York-Newark-Jersey City, NY-NJ-PA", "New York-Newark-…
    ## $ county_name <chr> "Queens County", "Queens County", "Queens County", "Queens…
    ## $ date        <date> 2024-07-31, 2024-08-31, 2016-05-31, 2016-06-30, 2016-07-3…
    ## $ year        <dbl> 2024, 2024, 2016, 2016, 2016, 2016, 2016, 2016, 2016, 2016…
    ## $ month       <ord> July, August, May, June, July, August, September, October,…
    ## $ zori        <dbl> 2322.418, 2282.500, 2266.140, 2292.023, 2320.788, 2343.339…

``` r
zip_lookup = read_csv("./data/Zip Codes.csv") |> 
  janitor::clean_names() |>
  #rename(zip_code = zipcode) |> 
  mutate(
    zip = str_pad(as.character(zip_code), 5, pad = "0")  # standardized zip
  ) |>
  distinct(zip, .keep_all = TRUE)
```

    ## Rows: 322 Columns: 7
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr (4): County, County Code, File Date, Neighborhood
    ## dbl (3): State FIPS, County FIPS, ZipCode
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
zori_long = zori_long |>
  mutate(
    zip = str_pad(as.character(region_name), 5, pad = "0")  # create proper zip
  )

#merge
zori_final = zori_long |>
  left_join(zip_lookup, by = "zip") |>
  arrange(zip, date)
glimpse(zori_final)
```

    ## Rows: 10,450
    ## Columns: 21
    ## $ region_id    <dbl> 61615, 61615, 61615, 61615, 61615, 61615, 61615, 61615, 6…
    ## $ size_rank    <dbl> 4444, 4444, 4444, 4444, 4444, 4444, 4444, 4444, 4444, 444…
    ## $ region_name  <dbl> 10001, 10001, 10001, 10001, 10001, 10001, 10001, 10001, 1…
    ## $ region_type  <chr> "zip", "zip", "zip", "zip", "zip", "zip", "zip", "zip", "…
    ## $ state_name   <chr> "NY", "NY", "NY", "NY", "NY", "NY", "NY", "NY", "NY", "NY…
    ## $ state        <chr> "NY", "NY", "NY", "NY", "NY", "NY", "NY", "NY", "NY", "NY…
    ## $ city         <chr> "New York", "New York", "New York", "New York", "New York…
    ## $ metro        <chr> "New York-Newark-Jersey City, NY-NJ-PA", "New York-Newark…
    ## $ county_name  <chr> "New York County", "New York County", "New York County", …
    ## $ date         <date> 2015-01-31, 2015-02-28, 2015-03-31, 2015-04-30, 2015-05-…
    ## $ year         <dbl> 2015, 2015, 2015, 2015, 2015, 2015, 2015, 2015, 2015, 201…
    ## $ month        <ord> January, February, March, April, May, June, July, August,…
    ## $ zori         <dbl> 3855.089, 3892.376, 3898.212, 3969.644, 4033.221, 4070.80…
    ## $ zip          <chr> "10001", "10001", "10001", "10001", "10001", "10001", "10…
    ## $ county       <chr> "New York", "New York", "New York", "New York", "New York…
    ## $ state_fips   <dbl> 36, 36, 36, 36, 36, 36, 36, 36, 36, 36, 36, 36, 36, 36, 3…
    ## $ county_code  <chr> "061", "061", "061", "061", "061", "061", "061", "061", "…
    ## $ county_fips  <dbl> 36061, 36061, 36061, 36061, 36061, 36061, 36061, 36061, 3…
    ## $ zip_code     <dbl> 10001, 10001, 10001, 10001, 10001, 10001, 10001, 10001, 1…
    ## $ file_date    <chr> "7/25/07", "7/25/07", "7/25/07", "7/25/07", "7/25/07", "7…
    ## $ neighborhood <chr> "Chelsea and Clinton", "Chelsea and Clinton", "Chelsea an…

### summary_and_analysis

``` r
cat("Total", nrow(zori_final), "\n")
```

    ## Total 10450

``` r
cat("Unique ZIP codes:", length(unique(zori_final$zip)), "\n")
```

    ## Unique ZIP codes: 149

``` r
cat("Unique neighborhoods:", length(unique(na.omit(zori_final$neighborhood))), "\n")
```

    ## Unique neighborhoods: 42

``` r
missing_zips = setdiff(zip_lookup$zip, zori_final$zip)
cat("zipcodes missing from Zillow data:", length(missing_zips), "\n")
```

    ## zipcodes missing from Zillow data: 171

``` r
#10 samples

head(missing_zips, 10) 
```

    ##  [1] "10464" "10474" "10475" "10499" "10550" "10704" "10705" "10803" "11202"
    ## [10] "11224"

``` r
# comparison between 2020 and 2021
covid_change = zori_final |>
  filter(month == "January", year %in% c(2020, 2021)) |>
  select(zip, borough = county, neighborhood, year, zori) |>
  pivot_wider(names_from = year, values_from = zori, names_prefix = "year_") |>
  mutate(change = year_2021 - year_2020) |>
  arrange(change)  # sort by largest drop

top10_drops = covid_change |> 
  slice(1:10)

top10_drops
```

    ## # A tibble: 10 × 6
    ##    zip   borough  neighborhood                  year_2020 year_2021 change
    ##    <chr> <chr>    <chr>                             <dbl>     <dbl>  <dbl>
    ##  1 10007 New York Lower Manhattan                   6334.     5422.  -913.
    ##  2 10069 New York <NA>                              4623.     3875.  -748.
    ##  3 10009 New York Lower East Side                   3406.     2692.  -714.
    ##  4 10016 New York Gramercy Park and Murray Hill     3731.     3019.  -712.
    ##  5 10001 New York Chelsea and Clinton               4108.     3398.  -710.
    ##  6 10002 New York Lower East Side                   3645.     2935.  -710.
    ##  7 10004 New York Lower Manhattan                   3150.     2444.  -706.
    ##  8 10038 New York Lower Manhattan                   3573.     2876.  -698.
    ##  9 10012 New York Greenwich Village and Soho        3629.     2942.  -686.
    ## 10 10010 New York Gramercy Park and Murray Hill     3697.     3012.  -685.

### Comments

The final tidy dataset contains 10450 observations, spanning 149 unique
ZIP codes and 42 unique neighborhoods, with each row representing rental
prices for a ZIP code in a given month. Several ZIP codes in the lookup
dataset are missing from Zillow’s ZORI data. Comparing January 2021 to
January 2020, the largest rent drops occurred mainly in Manhattan, with
somedeclines in Brooklyn and Queens, showing the outmigration from
dense, high-cost neighborhoods to other places.
